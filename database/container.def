Bootstrap: docker
From: mysql:8.0-debian

%files
    init.sql /data/init.sql

%post
    mkdir -p /data/mysql
    mkdir -p /var/run/mysqld
    
    apt-get update
    apt-get install gettext-base

You can disable Unix socket connections entirely and force TCP-only in your MySQL configuration:

    cat > /etc/mysql/conf.d/custom.cnf << 'EOF'
[mysqld]
bind-address = 0.0.0.0
port = 3306
skip-networking = 0
skip-name-resolve

[client]
protocol = TCP
port = 3306
host = 127.0.0.1
EOF

%startscript 
    : "${DB_ROOT_PASSWORD:?database root password must be provided via --env-file}"
    : "${DB_HOST:?database hostname must be provided via --env-file}"
    : "${DB_NAME:?database identifier must be provided via --env-file}"
    : "${DB_USER:?database user name must be provided via --env-file}"
    : "${DB_PASSWORD:?database password must be provided via --env-file}"

    if [ ! -d "/data/mysql/mysql" ]; then
        echo "Initializing database..."	
        mysqld --initialize-insecure --user=mysql --datadir=/data/mysql
        sleep 30
	echo "Setting up database ..."
        mysql -u root <<EOF
            $(envsubst < /data/init.sql)
EOF
    fi

    exec mysqld \
        --datadir=/data/mysql \
        --user=mysql 
